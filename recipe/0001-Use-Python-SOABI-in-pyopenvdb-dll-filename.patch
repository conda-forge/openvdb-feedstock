From dd03bc5e334656ad08372cb8750b46c843ca8c8d Mon Sep 17 00:00:00 2001
From: Anton Tetov <anton@tetov.se>
Date: Wed, 20 Sep 2023 11:15:14 +0200
Subject: [PATCH] Use Python SOABI in pyopenvdb dll filename

Requirement for compatibility with PyPy. See https://github.com/conda-forge/openvdb-feedstock/pull/4#issuecomment-1694596760
---
 openvdb/openvdb/python/CMakeLists.txt | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/openvdb/openvdb/python/CMakeLists.txt b/openvdb/openvdb/python/CMakeLists.txt
index 82d7c5ac..cc810cbb 100644
--- a/openvdb/openvdb/python/CMakeLists.txt
+++ b/openvdb/openvdb/python/CMakeLists.txt
@@ -253,9 +253,9 @@ endif()
 add_library(pyopenvdb SHARED ${OPENVDB_PYTHON_MODULE_SOURCE_FILES})
 set_target_properties(pyopenvdb PROPERTIES PREFIX "")  # no 'lib' prefix
 if(UNIX)
-  set_target_properties(pyopenvdb PROPERTIES SUFFIX ".so") # must be .so (not .dylib)
+  set_target_properties(pyopenvdb PROPERTIES SUFFIX "${Python_SOABI}.so") # must be .so (not .dylib)
 elseif(WIN32)
-  set_target_properties(pyopenvdb PROPERTIES SUFFIX ".pyd") # .pyd on windows
+  set_target_properties(pyopenvdb PROPERTIES SUFFIX "${Python_SOABI}.pyd") # .pyd on windows
 endif()
 
 target_link_libraries(pyopenvdb PUBLIC
-- 
2.42.0

